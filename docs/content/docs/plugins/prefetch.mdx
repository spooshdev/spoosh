---
title: Prefetch
description: Preload data before it's needed
---

The prefetch plugin lets you load data ahead of time, so it's ready when the user navigates.

## Installation

```package-install
@spoosh/plugin-prefetch
```

## Usage

```typescript
import { Spoosh } from "@spoosh/core";
import { prefetchPlugin } from "@spoosh/plugin-prefetch";
import { cachePlugin } from "@spoosh/plugin-cache";

const client = new Spoosh<ApiSchema, Error>("/api").use([
  prefetchPlugin(),
  cachePlugin({ staleTime: 5000 }),
]);

const { useRead, useWrite, prefetch } = createReactSpoosh(client);
```

## Basic Prefetch

```typescript
// Prefetch data
await prefetch((api) => api.posts.$get());

// Prefetch with query parameters
await prefetch((api) => api.posts.$get({ query: { page: 1, limit: 10 } }));
```

## Prefetch with Options

Pass plugin options as the second argument:

```typescript
await prefetch((api) => api.users(userId).$get(), {
  staleTime: 60000,
  retries: 3,
});
```

## Prefetch on Hover

A common pattern is prefetching when the user hovers over a link:

```typescript
<Link
  href="/posts/1"
  onMouseEnter={() => prefetch((api) => api.posts(1).$get())}
>
  View Post
</Link>
```

## Prefetch on Route Change

Prefetch data before navigating:

```typescript
async function handleNavigation(postId: number) {
  await prefetch((api) => api.posts(postId).$get());
  router.push(`/posts/${postId}`);
}
```

## In-Flight Deduplication

Multiple calls to prefetch the same data will return the same promise, avoiding duplicate network requests. This is built into the prefetch plugin - no deduplication plugin required.

```typescript
// These will only make ONE network request
prefetch((api) => api.posts.$get());
prefetch((api) => api.posts.$get());
prefetch((api) => api.posts.$get());
```

## Options

### Plugin Config

| Option      | Type     | Default | Description                                                                                       |
| ----------- | -------- | ------- | ------------------------------------------------------------------------------------------------- |
| `staleTime` | `number` | -       | Default stale time for prefetched data (ms)                                                       |
| `timeout`   | `number` | `30000` | Timeout to auto-clear stale promises (ms). Prevents memory leaks from requests that never settle. |

### Prefetch Options

The second argument accepts any plugin options plus:

| Option           | Type       | Description               |
| ---------------- | ---------- | ------------------------- |
| `tags`           | `string[]` | Custom cache tags         |
| `additionalTags` | `string[]` | Additional tags to append |
