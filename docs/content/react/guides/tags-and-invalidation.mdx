---
title: Tags & Invalidation
description: Understand how queries are tagged and when they refresh
---

Spoosh uses **tags** to determine which queries should refresh after a mutation. Understanding this system helps you control cache behavior effectively.

> This guide covers the [Invalidation Plugin](/docs/react/plugins/invalidation). See the plugin page for installation and configuration.

## The Mental Model

Every query is automatically tagged based on its API path. When a mutation succeeds, Spoosh finds all active queries with matching tags and refetches them.

```typescript
// This query gets tagged with: ["users", "users/123", "users/123/posts"]
useRead((api) => api("users/:id/posts").GET({ params: { id: 123 } }));

// When this mutation succeeds...
const { trigger } = useWrite((api) => api("users/:id").PATCH());
await trigger({ params: { id: 123 }, body: updated });
// → Tags ["users", "users/123"] are invalidated
// → The query above refetches because its tags overlap
```

This hierarchical tagging means mutations automatically refresh related queries without manual wiring.

## Tag Modes

Control how granular your query's tags are:

| Mode              | Tags Generated      | Use When                                         |
| ----------------- | ------------------- | ------------------------------------------------ |
| `"all"` (default) | Full path hierarchy | You want refreshes from parent/sibling mutations |
| `"self"`          | Exact endpoint only | You only want refreshes from this exact endpoint |

```typescript
// "all" mode (default) — refreshes when users, users/5, or users/5/posts mutate
useRead((api) => api("users/:id/posts").GET({ params: { id: "5" } }));

// "self" mode — only refreshes when users/5/posts specifically mutates
useRead((api) => api("users/:id/posts").GET({ params: { id: "5" } }), {
  tags: "self",
});
```

### Custom Tags

Add your own tags for cross-domain invalidation:

```typescript
// Replace auto-generated tags entirely
useRead((api) => api("dashboard/stats").GET(), {
  tags: ["dashboard", "analytics"],
});

// Combine mode with custom tags
useRead((api) => api("users/:id/posts").GET({ params: { id: "5" } }), {
  tags: ["all", "dashboard"], // hierarchy + custom
});
```

## Invalidation Strategies

After a mutation, you control what gets invalidated:

| Strategy           | Effect                                         |
| ------------------ | ---------------------------------------------- |
| `"all"` (default)  | Invalidate full path hierarchy of the mutation |
| `"self"`           | Invalidate only the exact mutation endpoint    |
| `"none"`           | Skip invalidation entirely                     |
| `"*"`              | Global refetch — every active query refetches  |
| `["tag1", "tag2"]` | Invalidate specific tags                       |

```typescript
const { trigger } = useWrite((api) => api("posts").POST());

// Standard CRUD — let related queries refresh
await trigger({ body: newPost, invalidate: "all" });

// Surgical update — only this endpoint's queries refresh
await trigger({ body: newPost, invalidate: "self" });

// Cross-domain — refresh unrelated queries too
await trigger({ body: newPost, invalidate: ["all", "dashboard"] });
```

## Manual Invalidation

For events outside mutations (WebSocket, timers, external state), trigger invalidation manually:

```typescript
import { invalidate } from "./spoosh";

// From a WebSocket handler
socket.on("data-changed", (tags) => invalidate(tags));

// Force everything to refresh
socket.on("full-sync", () => invalidate("*"));
```

## Choosing the Right Strategy

| Scenario                      | Strategy                               |
| ----------------------------- | -------------------------------------- |
| Standard CRUD                 | `invalidate: "all"` (default)          |
| Updating a single resource    | `invalidate: "self"`                   |
| No related queries to refresh | `invalidate: "none"`                   |
| User logout / account switch  | `invalidate: "*"` + `clearCache: true` |
| Cross-domain updates          | `invalidate: ["posts", "dashboard"]`   |
| External events (WebSocket)   | `invalidate(tags)` manually            |

---

For complete API reference, configuration options, and advanced examples, see the [Invalidation Plugin](/docs/react/plugins/invalidation).
